# Use Case Specification: 대시보드 조회 (3종 차트)

**문서 버전:** 1.0
**작성일:** 2025-12-18
**기능 번호:** UC-002
**우선순위:** High

---

## 1. 개요

### 1.1 기능 설명
사용자가 로그인 후 대시보드 페이지에 접근하여 업로드된 실적 데이터를 3종 차트(월별 추이 라인 차트, 부서별 실적 막대그래프, 카테고리별 분포 파이 차트)로 시각화하여 조회하고, 필터를 적용하여 원하는 데이터만 분석할 수 있다.

### 1.2 비즈니스 목표
- 대학 내부 직원들이 이카운트에서 추출한 데이터를 직관적으로 파악
- 실적, 논문, 학생 수, 예산 등의 추이와 분포를 시각적으로 이해
- 부서별, 카테고리별 비교 분석을 통한 의사결정 지원

### 1.3 성공 지표
- 대시보드 초기 로딩 시간 3초 이내
- 필터 적용 시 1초 이내 리렌더링
- 별도 교육 없이 직관적 사용 가능

---

## 2. 액터 (Actors)

### 2.1 주요 액터
- **일반 사용자 (Viewer)**: 대시보드 조회만 가능한 직원
- **관리자 (Administrator)**: 대시보드 조회 및 데이터 업로드 가능한 직원

### 2.2 시스템 액터
- **Django Backend API**: 데이터 조회 및 인증 처리
- **PostgreSQL Database**: 실적 데이터 저장소
- **React Frontend**: 차트 렌더링 및 사용자 인터랙션 처리

---

## 3. 사전 조건 (Preconditions)

1. 사용자가 Django 인증을 통해 로그인한 상태
2. 세션 쿠키가 브라우저에 저장되어 있음
3. 데이터베이스에 최소 1건 이상의 PerformanceData 레코드가 존재
4. 사용자의 브라우저가 JavaScript 및 쿠키를 지원

---

## 4. 사후 조건 (Postconditions)

### 4.1 성공 시
- 3종 차트가 화면에 정상적으로 렌더링됨
- 필터 적용 시 선택된 조건에 맞는 데이터만 차트에 표시됨
- 차트 호버 시 상세 수치가 툴팁으로 표시됨

### 4.2 실패 시
- 데이터가 없을 경우 빈 상태 메시지 표시
- 세션 만료 시 자동으로 로그인 페이지로 리다이렉트
- 네트워크 오류 시 에러 배너 및 재시도 버튼 표시

---

## 5. 기본 플로우 (Basic Flow)

### 5.1 대시보드 페이지 접근
1. 사용자가 로그인 완료 후 대시보드 페이지(`/dashboard`) 접근
2. React 프론트엔드가 `/api/data/` 엔드포인트로 GET 요청 전송
3. Django Backend에서 세션 쿠키 기반 인증 확인
4. 인증 성공 시 PerformanceData 모델에서 데이터 조회 (Django ORM)
5. 조회된 데이터를 JSON 형태로 직렬화하여 응답
6. React에서 데이터를 수신하여 상태(State)에 저장

### 5.2 차트 렌더링
7. 프론트엔드에서 데이터 가공
   - 월별 추이: `reference_date` 기준 GROUP BY 후 SUM 계산
   - 부서별 실적: `department` 기준 GROUP BY 후 SUM 계산
   - 카테고리별 분포: `category` 기준 COUNT 및 백분율 계산
8. Recharts 라이브러리를 사용하여 3종 차트 렌더링
   - 월별 추이 라인 차트 (LineChart)
   - 부서별 실적 막대그래프 (BarChart)
   - 카테고리별 분포 파이 차트 (PieChart)
9. Grid 레이아웃으로 차트 배치 (반응형 디자인)

### 5.3 차트 인터랙션
10. 사용자가 차트 위에 마우스 호버
11. 툴팁이 표시되어 해당 데이터의 상세 수치 확인
12. 파이 차트의 경우 섹션 클릭 시 해당 카테고리 상세 보기 (선택 사항)

---

## 6. 대체 플로우 (Alternative Flows)

### 6.1 필터 적용
1. 사용자가 기간 필터에서 시작일/종료일 선택 (DatePicker)
2. 또는 부서 필터에서 특정 부서 선택 (Multi-select Dropdown)
3. 또는 카테고리 필터에서 특정 카테고리 선택 (Checkbox Group)
4. React State 업데이트 (useState)
5. 쿼리 파라미터 재구성 (예: `/api/data/?start_date=2024-01-01&department=연구팀`)
6. `/api/data/` 엔드포인트로 필터 조건 포함한 GET 요청 전송
7. Django Backend에서 WHERE 절 적용하여 필터링된 데이터 조회
   - `reference_date` 인덱스 활용
   - `department` 인덱스 활용
8. 필터링된 결과를 JSON으로 응답
9. React에서 차트 리렌더링 (1초 이내)

### 6.2 데이터 없음
1. 데이터베이스에 조회 가능한 레코드가 없는 경우
2. API 응답: `[]` (빈 배열)
3. React에서 빈 상태 메시지 표시: "데이터가 없습니다. 엑셀을 업로드하세요."
4. 업로드 페이지로 이동할 수 있는 버튼 제공

### 6.3 필터 결과 없음
1. 필터 조건에 맞는 데이터가 없는 경우
2. API 응답: `[]` (빈 배열)
3. React에서 메시지 표시: "조건에 맞는 데이터가 없습니다."
4. 필터 초기화 버튼 제공

---

## 7. 예외 플로우 (Exception Flows)

### 7.1 세션 만료
1. API 요청 시 세션 쿠키가 유효하지 않음
2. Django Backend에서 HTTP 401 Unauthorized 응답
3. React에서 401 응답 감지 시 자동으로 `/admin/login/` 페이지로 리다이렉트
4. 사용자에게 "세션이 만료되었습니다. 다시 로그인하세요." 메시지 표시

### 7.2 네트워크 오류
1. `/api/data/` 요청 중 네트워크 연결 끊김 또는 타임아웃 (30초)
2. React에서 에러 catch
3. 에러 배너 표시: "서버와 연결할 수 없습니다. 인터넷 연결을 확인하세요."
4. 재시도 버튼 제공 (자동 재시도 최대 3회)

### 7.3 서버 오류
1. Django Backend에서 예외 발생 (예: DB 연결 실패)
2. HTTP 500 Internal Server Error 응답
3. React에서 에러 배너 표시: "서버 오류가 발생했습니다. 잠시 후 다시 시도하세요."
4. 관리자에게 알림 (로그 기록)

### 7.4 대용량 데이터
1. 조회 결과가 10,000건 이상인 경우
2. 차트 렌더링 시 성능 저하 우려
3. 프론트엔드에서 데이터 샘플링 적용 (1,000개 포인트로 제한)
4. 또는 페이지네이션 적용 안내 메시지 표시

---

## 8. 연관 페이지 및 컴포넌트

### 8.1 페이지
- **URL**: `/dashboard`
- **React Component**: `Dashboard.tsx`

### 8.2 주요 컴포넌트
- `DashboardLayout.tsx`: 전체 레이아웃 (사이드바, 헤더, 메인 영역)
- `MonthlyTrendChart.tsx`: 월별 추이 라인 차트
- `DepartmentBarChart.tsx`: 부서별 실적 막대그래프
- `CategoryPieChart.tsx`: 카테고리별 분포 파이 차트
- `FilterPanel.tsx`: 필터 영역 (DatePicker, Dropdown, Checkbox)

### 8.3 네비게이션
- 좌측 사이드바 메뉴:
  - 대시보드 (현재 페이지)
  - 데이터 업로드 (`/upload`)
  - 데이터 테이블 (`/data-table`)
  - 로그아웃

---

## 9. 연관 API

### 9.1 데이터 조회 API
- **Endpoint**: `GET /api/data/`
- **인증**: Session Cookie 필수
- **Query Parameters** (선택):
  - `start_date`: YYYY-MM-DD (기간 시작일)
  - `end_date`: YYYY-MM-DD (기간 종료일)
  - `department`: 부서명 (예: "연구팀")
  - `category`: 카테고리명 (예: "논문")
- **Response** (성공):
  ```json
  [
    {
      "id": 1,
      "reference_date": "2024-01-01",
      "department": "연구개발팀",
      "category": "논문",
      "value": "5.00",
      "created_at": "2024-01-15T10:30:00Z"
    },
    ...
  ]
  ```
- **Response** (실패):
  - `401 Unauthorized`: 인증 실패
  - `500 Internal Server Error`: 서버 오류

---

## 10. 데이터베이스

### 10.1 조회 대상 테이블
- **테이블명**: `performance_data`
- **Django Model**: `PerformanceData`

### 10.2 주요 컬럼
- `reference_date`: DATE (기준 날짜, 인덱스)
- `department`: VARCHAR(100) (부서명, 인덱스)
- `category`: VARCHAR(100) (카테고리명)
- `value`: DECIMAL(15, 2) (실적 값)
- `created_at`: TIMESTAMP (생성일)

### 10.3 쿼리 패턴
```python
# 전체 조회
PerformanceData.objects.all()

# 기간 필터링
PerformanceData.objects.filter(
    reference_date__gte=start_date,
    reference_date__lte=end_date
)

# 부서 필터링
PerformanceData.objects.filter(
    department__in=['연구팀', '행정팀']
)

# 복합 필터링
PerformanceData.objects.filter(
    reference_date__gte=start_date,
    department='연구팀'
)
```

---

## 11. 외부 연동 서비스

### 11.1 사용하지 않음
본 유스케이스는 외부 API나 서드파티 서비스와 연동하지 않음.

### 11.2 내부 서비스
- **Supabase PostgreSQL**: 데이터 저장소 (Railway를 통해 연결)
- **Django Session Store**: 인증 세션 관리
- **Recharts Library**: 클라이언트 측 차트 렌더링

---

## 12. UI/UX 요구사항

### 12.1 레이아웃
- **좌측 사이드바**: 네비게이션 메뉴
- **상단 헤더**: 페이지 제목 + 사용자 정보
- **필터 영역**: DatePicker, Multi-select, Checkbox (상단 또는 좌측)
- **차트 영역**: Grid 레이아웃 (3개 차트 반응형 배치)

### 12.2 차트 상세
1. **월별 추이 라인 차트**
   - X축: 월 (YYYY-MM 형식)
   - Y축: 실적 값 (숫자)
   - 색상: 단일 색상 (파란색 계열)
   - 호버: 툴팁 표시 (날짜 + 값)

2. **부서별 실적 막대그래프**
   - X축: 부서명
   - Y축: 실적 값
   - 색상: 부서별 고유 색상 자동 할당
   - 호버: 툴팁 표시 (부서명 + 값)

3. **카테고리별 분포 파이 차트**
   - 퍼센트 + 절대값 표시
   - 색상: 카테고리별 고유 색상
   - 호버: 툴팁 표시 (카테고리 + 백분율 + 값)
   - 클릭: 해당 카테고리 상세 보기 (선택 사항)

### 12.3 반응형 디자인
- 데스크탑: 3개 차트 가로 배치 (Grid 3열)
- 태블릿: 2개 차트 가로 배치 (Grid 2열)
- 모바일: 1개 차트 세로 배치 (Grid 1열)

### 12.4 로딩 상태
- 데이터 로딩 중: 각 차트 영역에 로딩 스피너 표시
- 로딩 완료 후 차트 페이드인 애니메이션

---

## 13. 성능 요구사항

### 13.1 응답 시간
- 대시보드 초기 로딩: 3초 이내
- 필터 적용 시 렌더링: 1초 이내
- API 응답 시간: 1초 이내 (10,000건 기준)

### 13.2 최적화 방법
- Django ORM에서 `reference_date`, `department` 인덱스 활용
- 프론트엔드에서 데이터 집계 처리 (DB 부하 최소화)
- Recharts의 가상 스크롤링 및 샘플링 기능 활용

---

## 14. 보안 요구사항

### 14.1 인증
- 모든 API 요청에 세션 쿠키 필수
- 세션 만료 시 자동 로그아웃 및 로그인 페이지 리다이렉트

### 14.2 권한
- 로그인한 사용자만 대시보드 접근 가능
- 비로그인 사용자 접근 시 `/admin/login/`으로 리다이렉트

### 14.3 데이터 보호
- HTTPS 프로토콜 사용 (Railway 기본 제공)
- 세션 쿠키 HttpOnly, Secure 플래그 설정
- CSRF 토큰 검증 (Django 기본 제공)

---

## 15. 테스트 시나리오

### 15.1 정상 동작 테스트
1. 로그인 후 대시보드 접근 시 3종 차트가 정상 렌더링됨
2. 필터 적용 시 조건에 맞는 데이터만 차트에 표시됨
3. 차트 호버 시 툴팁이 정확한 수치로 표시됨
4. 필터 초기화 시 전체 데이터로 차트 리렌더링됨

### 15.2 엣지케이스 테스트
1. 데이터가 없는 경우 빈 상태 메시지 표시
2. 필터 조건에 맞는 데이터가 없는 경우 메시지 표시
3. 10,000건 이상 데이터 조회 시 성능 확인 (샘플링 적용)
4. 세션 만료 시 자동 로그인 페이지 리다이렉트

### 15.3 오류 처리 테스트
1. 네트워크 오류 시 에러 배너 및 재시도 버튼 표시
2. 서버 오류 (500) 시 에러 메시지 표시
3. 인증 실패 (401) 시 로그인 페이지 리다이렉트

---

## 16. 비기능 요구사항

### 16.1 접근성
- WCAG 2.1 Level A 준수
- 키보드 네비게이션 지원 (Tab, Enter, Esc)
- 차트에 대체 텍스트 제공 (aria-label)

### 16.2 브라우저 호환성
- Chrome 최신 버전
- Firefox 최신 버전
- Safari 최신 버전
- Edge 최신 버전

### 16.3 유지보수성
- 컴포넌트 분리 원칙 (차트별 독립 컴포넌트)
- TypeScript 타입 정의로 코드 안정성 확보
- 한글 주석으로 복잡한 로직 설명

---

## 17. 제약사항 및 가정

### 17.1 제약사항
- 집계 로직은 프론트엔드에서 처리 (DB 부하 최소화)
- 대용량 데이터 조회 시 샘플링 적용 (1,000개 포인트)
- 실시간 데이터 갱신 없음 (페이지 새로고침 필요)

### 17.2 가정
- 사용자가 Chrome 또는 주요 모던 브라우저 사용
- 데이터베이스에 최소 1건 이상의 데이터 존재
- 이카운트에서 추출한 엑셀 데이터가 정확한 형식으로 업로드됨

---

## 18. 후속 개선사항

### 18.1 단기 개선 (MVP 이후)
- 차트 레이아웃 커스터마이징 기능 (드래그 앤 드롭)
- 필터 저장 기능 (즐겨찾기)
- 차트 이미지 다운로드 기능 (PNG, SVG)

### 18.2 장기 개선
- 실시간 데이터 갱신 (WebSocket 또는 Polling)
- 대시보드 공유 기능 (URL 링크 생성)
- 고급 필터 (다중 조건, AND/OR 로직)
- 집계 테이블 추가로 대용량 데이터 성능 개선

---

## 19. 참고 문서

- `/docs/userflow.md`: 2번 기능 상세 플로우
- `/docs/prd.md`: 3.2 대시보드 페이지 요구사항
- `/docs/database.md`: PerformanceData 스키마 정의
- `/docs/requirement.md`: 원본 프로젝트 요구사항

---

**문서 승인**
- [ ] Product Owner
- [ ] Developer
- [ ] QA Engineer

**변경 이력**
| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-12-18 | 초안 작성 | Usecase Writer Agent |

---

**End of Document**
