# Use Case 004: 데이터 테이블 조회 (MUI DataGrid)

**문서 버전:** 1.0
**작성일:** 2025-12-18
**기능명:** 데이터 테이블 조회
**우선순위:** Medium
**관련 페이지:** `/data-table`

---

## 1. 개요 (Overview)

### 1.1 목적
업로드된 원본 데이터를 테이블 형태로 조회하고, 정렬/검색/내보내기 기능을 제공하여 사용자가 상세 데이터를 확인하고 검증할 수 있도록 지원합니다.

### 1.2 사용자 대상
- **관리자**: 업로드한 데이터 검증 및 특정 레코드 확인
- **일반 사용자**: 차트에서 확인한 수치의 원본 데이터 조회

### 1.3 비즈니스 가치
- 데이터 투명성 제공 (차트 수치의 근거 확인 가능)
- 엑셀 업로드 후 데이터 검증 용이
- CSV 내보내기로 2차 가공 지원

---

## 2. 사용자 시나리오

### 2.1 기본 시나리오: 전체 데이터 조회
1. 사용자가 좌측 사이드바에서 "데이터 테이블" 메뉴 클릭
2. `/data-table` 페이지로 이동
3. 시스템이 전체 데이터를 테이블 형태로 표시
4. 사용자가 스크롤하며 데이터 확인

### 2.2 확장 시나리오 1: 검색
1. 사용자가 테이블 상단 검색 바에 "연구개발팀" 입력
2. 시스템이 모든 컬럼에서 "연구개발팀" 텍스트 매칭 수행
3. 필터링된 결과만 테이블에 표시
4. 사용자가 검색어 삭제 시 전체 데이터 복원

### 2.3 확장 시나리오 2: 정렬
1. 사용자가 "날짜" 컬럼 헤더 클릭
2. 시스템이 날짜 기준 오름차순으로 정렬
3. 사용자가 동일 헤더 재클릭
4. 시스템이 내림차순으로 정렬 변경
5. 정렬 상태가 화살표 아이콘으로 표시됨

### 2.4 확장 시나리오 3: 페이지네이션
1. 사용자가 테이블 하단의 페이지 번호 확인 (전체 데이터 1,000개, 50개/페이지 = 20페이지)
2. "다음" 버튼 클릭으로 2페이지 이동
3. 51~100번째 데이터 표시

### 2.5 확장 시나리오 4: CSV 내보내기
1. 사용자가 "CSV 내보내기" 버튼 클릭
2. 시스템이 현재 필터/정렬 상태의 데이터를 CSV 파일로 변환
3. 파일명: `data_export_20250118.csv` (날짜 자동 포함)
4. 브라우저 다운로드 폴더에 저장 완료

---

## 3. 기능 요구사항

### 3.1 테이블 컬럼 구성
| 컬럼명 | 데이터 타입 | 정렬 가능 | 검색 대상 | 비고 |
|--------|-------------|----------|----------|------|
| 날짜 (reference_date) | Date | Yes | Yes | YYYY-MM-DD 형식 |
| 부서 (department) | String | Yes | Yes | - |
| 카테고리 (category) | String | Yes | Yes | - |
| 실적 (value) | Decimal | Yes | Yes | 1,000 단위 구분자 표시 |

### 3.2 검색 기능
- **대상**: 모든 컬럼
- **방식**: 클라이언트 측 필터링 (API 재요청 없음)
- **조건**: 대소문자 구분 없음, 부분 일치
- **성능**: 1,000개 행 기준 200ms 이내 응답

### 3.3 정렬 기능
- **방식**: 컬럼 헤더 클릭 토글
- **상태**: 기본 → 오름차순 → 내림차순 → 기본
- **표시**: 화살표 아이콘 (↑ 오름차순, ↓ 내림차순)

### 3.4 페이지네이션
- **행 수**: 50개/페이지 (고정)
- **컨트롤**: 이전/다음 버튼, 페이지 번호
- **표시**: "1-50 of 1,000" 형식

### 3.5 CSV 내보내기
- **포맷**: UTF-8 with BOM (한글 엑셀 호환)
- **컬럼**: 테이블과 동일 (4개 컬럼)
- **파일명**: `data_export_YYYYMMDD.csv`
- **용량 제한**: 10,000개 행까지 (약 1MB)

---

## 4. 연관 API 및 서비스

### 4.1 API 엔드포인트
| Endpoint | Method | 인증 | 목적 |
|----------|--------|------|------|
| `/api/data/` | GET | 필수 | 전체 데이터 조회 |

### 4.2 API 요청 예시
```http
GET /api/data/ HTTP/1.1
Host: example.railway.app
Cookie: sessionid=abc123
```

**Query Parameters (선택)**:
- `start_date`: YYYY-MM-DD (기간 필터 시작)
- `end_date`: YYYY-MM-DD (기간 필터 종료)
- `department`: 부서명 (부서 필터)

### 4.3 API 응답 예시
```json
[
  {
    "reference_date": "2024-01-01",
    "department": "연구개발팀",
    "category": "논문",
    "value": "5.00"
  },
  {
    "reference_date": "2024-01-01",
    "department": "행정팀",
    "category": "예산",
    "value": "1200000.00"
  }
]
```

### 4.4 외부 서비스
- **없음** (모든 처리는 클라이언트 측에서 수행)

---

## 5. UI/UX 요구사항

### 5.1 레이아웃
```
┌─────────────────────────────────────────────┐
│ [좌측 사이드바]  데이터 테이블              │
├─────────────────────────────────────────────┤
│ 검색: [                    ] [CSV 내보내기] │
├─────────────────────────────────────────────┤
│ 날짜 ↑ │ 부서    │ 카테고리 │ 실적        │
├─────────────────────────────────────────────┤
│ 2024-01-01 │ 연구팀 │ 논문    │ 5.00      │
│ 2024-01-01 │ 행정팀 │ 예산    │ 1,200,000 │
│ ...                                         │
├─────────────────────────────────────────────┤
│ 1-50 of 1,000  [이전] 1 2 3 [다음]          │
└─────────────────────────────────────────────┘
```

### 5.2 인터랙션
- **행 호버**: 배경색 변경 (#f5f5f5)
- **헤더 클릭**: 정렬 상태 토글 + 아이콘 변경
- **검색 입력**: 500ms debounce 후 필터링
- **페이지 이동**: 즉시 반영

### 5.3 반응형 디자인
- **데스크탑 (>1024px)**: 전체 컬럼 표시
- **태블릿 (768-1024px)**: 가로 스크롤
- **모바일 (<768px)**: 가로 스크롤 + 고정 좌측 컬럼

---

## 6. 데이터 플로우

### 6.1 초기 로딩
```
[사용자] → [/data-table 접근]
    ↓
[React Component Mount]
    ↓
[GET /api/data/]
    ↓
[Django ORM] → SELECT * FROM performance_data ORDER BY reference_date DESC
    ↓
[JSON 응답] → [MUI DataGrid 렌더링]
```

### 6.2 검색 플로우
```
[사용자] → [검색어 입력: "연구팀"]
    ↓
[500ms debounce]
    ↓
[Array.filter()] → row.includes("연구팀")
    ↓
[DataGrid 리렌더링]
```

### 6.3 CSV 내보내기 플로우
```
[사용자] → [CSV 내보내기 버튼 클릭]
    ↓
[현재 상태 데이터 추출] (필터/정렬 반영)
    ↓
[CSV 변환] → Header + Rows
    ↓
[Blob 생성] → UTF-8 with BOM
    ↓
[다운로드 트리거] → data_export_20250118.csv
```

---

## 7. 엣지케이스 및 에러 처리

### 7.1 데이터 없음
- **상황**: DB에 데이터가 0개
- **표시**: "조회된 데이터가 없습니다. 엑셀을 업로드하세요."
- **액션**: 업로드 페이지로 이동 버튼 제공

### 7.2 검색 결과 없음
- **상황**: 검색어에 매칭되는 데이터 0개
- **표시**: "검색 결과가 없습니다. 다른 검색어를 시도하세요."
- **액션**: 검색어 지우기 버튼

### 7.3 네트워크 오류
- **상황**: API 요청 실패 (timeout, 5xx 에러)
- **표시**: 에러 배너 "데이터를 불러올 수 없습니다."
- **액션**: 재시도 버튼 제공

### 7.4 대용량 데이터
- **상황**: 10,000개 이상 데이터
- **처리**: MUI DataGrid의 가상 스크롤링 자동 적용
- **성능**: 렌더링 시간 1초 이내 유지

### 7.5 세션 만료
- **상황**: API 응답 401 Unauthorized
- **처리**: 자동으로 로그인 페이지 리다이렉트
- **메시지**: "세션이 만료되었습니다. 다시 로그인하세요."

### 7.6 CSV 내보내기 실패
- **상황**: 브라우저 다운로드 차단, 메모리 부족
- **표시**: "파일 다운로드에 실패했습니다."
- **액션**: 팝업 차단 해제 안내 또는 재시도

---

## 8. 성능 요구사항

| 항목 | 목표 | 측정 방법 |
|------|------|----------|
| 초기 로딩 | 3초 이내 | Time to Interactive |
| 검색 응답 | 200ms 이내 | Input debounce 후 렌더링 완료 |
| 정렬 응답 | 200ms 이내 | 클릭 후 렌더링 완료 |
| 페이지 이동 | 즉시 (100ms) | 클릭 후 렌더링 |
| CSV 생성 | 2초 이내 | 10,000개 행 기준 |

---

## 9. 보안 요구사항

### 9.1 인증
- 모든 사용자는 로그인 필수
- 세션 쿠키 기반 인증
- 미인증 사용자는 로그인 페이지로 리다이렉트

### 9.2 권한
- 데이터 조회: 모든 인증된 사용자
- CSV 내보내기: 모든 인증된 사용자 (제한 없음)

### 9.3 데이터 보호
- API 응답은 HTTPS로만 전송
- 세션 쿠키는 HttpOnly, Secure 플래그 설정
- CSRF 토큰 검증 (Django 기본)

---

## 10. 검증 기준 (Acceptance Criteria)

### 10.1 기본 기능
- [ ] 로그인 후 /data-table 접근 시 데이터 테이블 표시
- [ ] 4개 컬럼(날짜, 부서, 카테고리, 실적) 정상 표시
- [ ] 50개/페이지 페이지네이션 동작
- [ ] 페이지 전환 시 데이터 정확히 표시

### 10.2 검색 기능
- [ ] 검색어 입력 시 500ms debounce 적용
- [ ] 모든 컬럼 대상 텍스트 매칭 동작
- [ ] 대소문자 구분 없이 검색
- [ ] 검색 결과 없을 시 안내 메시지 표시

### 10.3 정렬 기능
- [ ] 각 컬럼 헤더 클릭 시 정렬 동작
- [ ] 오름차순/내림차순 토글 정상 작동
- [ ] 정렬 상태 화살표 아이콘 표시
- [ ] 날짜 정렬 시 시간순 정렬 (문자열 아님)

### 10.4 CSV 내보내기
- [ ] CSV 내보내기 버튼 클릭 시 파일 다운로드
- [ ] 파일명에 날짜 포함 (YYYYMMDD)
- [ ] UTF-8 with BOM 인코딩 (한글 정상 표시)
- [ ] 현재 필터/정렬 상태 반영
- [ ] 엑셀에서 열 시 깨짐 없음

### 10.5 에러 처리
- [ ] 데이터 없을 시 안내 메시지 표시
- [ ] 네트워크 오류 시 재시도 버튼 표시
- [ ] 세션 만료 시 로그인 페이지 리다이렉트
- [ ] 로딩 중 스피너 표시

### 10.6 성능
- [ ] 초기 로딩 3초 이내
- [ ] 1,000개 데이터 검색 200ms 이내
- [ ] 10,000개 데이터 정렬 500ms 이내
- [ ] CSV 내보내기 2초 이내

---

## 11. 기술 스택

### 11.1 프론트엔드
- **UI 라이브러리**: MUI DataGrid
- **프레임워크**: React 18 + TypeScript
- **상태 관리**: React useState (로컬 상태)
- **데이터 가공**: Lodash (groupBy, filter)

### 11.2 백엔드
- **프레임워크**: Django 4.2
- **ORM**: Django ORM
- **직렬화**: Django Rest Framework Serializer

### 11.3 데이터베이스
- **DB**: PostgreSQL (Supabase)
- **테이블**: `performance_data`
- **인덱스**: `reference_date`, `department`

---

## 12. 개발 우선순위

### P0 (필수)
- 테이블 기본 렌더링
- 페이지네이션 (50개/페이지)
- API 연동 (`/api/data/`)

### P1 (중요)
- 검색 기능
- 정렬 기능
- CSV 내보내기

### P2 (선택)
- 반응형 디자인
- 로딩 스피너
- 에러 처리 강화

---

## 13. 향후 확장 가능성

### 13.1 필터 고도화
- 날짜 범위 필터 (DatePicker)
- 부서 멀티 셀렉트 필터
- 카테고리 필터

### 13.2 컬럼 커스터마이징
- 사용자가 보기 원하는 컬럼 선택
- 컬럼 순서 변경 (Drag & Drop)

### 13.3 데이터 편집
- 테이블에서 직접 수정 (inline editing)
- 수정 사항 DB 반영

### 13.4 Excel 내보내기
- CSV 외 .xlsx 형식 지원
- 차트 포함 Excel 파일 생성

---

## 14. 관련 문서

- [PRD 문서](/docs/prd.md) - 3.4절 데이터 테이블 페이지
- [User Flow 문서](/docs/userflow.md) - 4번 기능
- [Database 문서](/docs/database.md) - performance_data 테이블
- [Requirement 문서](/docs/requirement.md) - 기능 요구사항

---

**문서 작성**: Usecase Writer Agent
**검토 필요**: Product Owner, Frontend Developer
**최종 승인**: 대기 중
