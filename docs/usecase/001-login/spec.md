# Use Case: 로그인 (Django Native Auth)

**문서 버전:** 1.0
**작성일:** 2025-12-18
**기능 ID:** UC-001
**우선순위:** High

---

## 1. 개요

### 1.1 목적
대학 데이터 시각화 대시보드에 접근하기 위한 사용자 인증 기능을 제공한다. 허가된 사용자만 시스템에 접근할 수 있도록 보안을 강화하고, 세션 기반 인증을 통해 사용자 상태를 유지한다.

### 1.2 범위
- 사용자 로그인 (아이디/비밀번호)
- 세션 생성 및 관리
- 로그인 실패 처리
- 계정 잠금 (보안)

### 1.3 관련 기능
- **선행 조건**: Django Admin에서 사용자 계정 사전 생성
- **후행 기능**: 대시보드 조회 (UC-002), 엑셀 업로드 (UC-003)

---

## 2. 액터 (Actors)

| 액터 | 역할 | 권한 |
|------|------|------|
| **대학 내부 직원** | 로그인하여 시스템 접근 | 일반 사용자 |
| **관리자** | 로그인 + 데이터 업로드 | Staff 권한 |
| **Django 인증 시스템** | 자격 증명 검증 | 시스템 |

---

## 3. 사전 조건 (Preconditions)

1. 사용자 계정이 Django Admin에 사전 등록되어 있음
2. 사용자가 유효한 Username과 Password를 보유
3. 계정이 활성 상태 (`is_active=True`)
4. 계정이 잠금 상태가 아님

---

## 4. 주요 플로우 (Main Flow)

### 4.1 정상 시나리오

| 단계 | 액터 | 동작 | 시스템 응답 |
|------|------|------|------------|
| 1 | 사용자 | 로그인 페이지 접근 (`/admin/login/`) | 로그인 폼 표시 |
| 2 | 사용자 | Username 입력 | 입력 필드 활성화 |
| 3 | 사용자 | Password 입력 | 입력 필드 활성화 (마스킹) |
| 4 | 사용자 | "로그인" 버튼 클릭 | POST 요청 전송 |
| 5 | 시스템 | CSRF 토큰 검증 | 검증 성공 |
| 6 | 시스템 | Django Authentication Backend에서 자격 증명 확인 | 인증 성공 |
| 7 | 시스템 | 세션 ID 생성, 세션 쿠키 설정 (HttpOnly, Secure) | 세션 저장 |
| 8 | 시스템 | 로그인 성공 로그 기록 | 데이터베이스 저장 |
| 9 | 시스템 | HTTP 302 리다이렉트 응답 | 대시보드 페이지 (`/dashboard`) 이동 |
| 10 | 사용자 | 대시보드 화면 확인 | 로그인 완료 |

---

## 5. 대체 플로우 (Alternative Flows)

### 5.1 로그인 실패 - 잘못된 자격 증명

| 단계 | 액터 | 동작 | 시스템 응답 |
|------|------|------|------------|
| 4A | 사용자 | 잘못된 Username 또는 Password 입력 | - |
| 5A | 시스템 | 인증 실패 | HTTP 401 Unauthorized |
| 6A | 시스템 | 로그인 실패 로그 기록 | 타임스탬프 저장 |
| 7A | 시스템 | 에러 메시지 표시 | "아이디 또는 비밀번호가 올바르지 않습니다." |
| 8A | 시스템 | Username은 유지, Password만 초기화 | 입력 폼 재표시 |

### 5.2 계정 잠금 - 연속 실패

| 단계 | 액터 | 동작 | 시스템 응답 |
|------|------|------|------------|
| 5B | 시스템 | 동일 Username으로 5회 연속 실패 감지 | 잠금 조건 충족 |
| 6B | 시스템 | 계정 15분간 잠금 | 잠금 타임스탬프 저장 |
| 7B | 시스템 | 에러 메시지 표시 | "계정이 잠겼습니다. 15분 후 다시 시도하세요." |
| 8B | 사용자 | 15분 대기 후 재시도 | 잠금 해제 |

### 5.3 CSRF 토큰 만료

| 단계 | 액터 | 동작 | 시스템 응답 |
|------|------|------|------------|
| 5C | 시스템 | CSRF 토큰 검증 실패 | HTTP 403 Forbidden |
| 6C | 시스템 | 에러 메시지 표시 | "세션이 만료되었습니다. 페이지를 새로고침하세요." |
| 7C | 사용자 | 페이지 새로고침 (F5) | 새 CSRF 토큰 생성 |
| 8C | 사용자 | 재로그인 시도 | 정상 처리 |

### 5.4 네트워크 오류

| 단계 | 액터 | 동작 | 시스템 응답 |
|------|------|------|------------|
| 4D | 사용자 | "로그인" 버튼 클릭 | POST 요청 전송 |
| 5D | 시스템 | 네트워크 타임아웃 발생 (30초 초과) | - |
| 6D | 프론트엔드 | 타임아웃 에러 캐치 | 에러 메시지 표시 |
| 7D | 시스템 | "네트워크 오류가 발생했습니다. 다시 시도하세요." | 재시도 버튼 활성화 |

---

## 6. 예외 플로우 (Exception Flows)

### 6.1 비활성 계정

| 조건 | 시스템 응답 |
|------|------------|
| `is_active=False` | "계정이 비활성화되었습니다. 관리자에게 문의하세요." |

### 6.2 존재하지 않는 Username

| 조건 | 시스템 응답 |
|------|------------|
| 데이터베이스에 Username 없음 | "아이디 또는 비밀번호가 올바르지 않습니다." (보안상 동일 메시지) |

---

## 7. 사후 조건 (Postconditions)

### 7.1 성공 시
- 사용자 세션이 생성되어 서버에 저장됨
- 세션 쿠키가 브라우저에 저장됨 (HttpOnly, Secure 플래그)
- 로그인 성공 로그가 데이터베이스에 기록됨
- 사용자가 대시보드 페이지로 리다이렉트됨
- 이후 모든 API 요청에서 세션 인증 자동 적용

### 7.2 실패 시
- 세션 생성되지 않음
- 로그인 실패 로그 기록 (Username, 타임스탬프)
- 실패 횟수 카운트 증가 (5회 이상 시 계정 잠금)

---

## 8. 관련 페이지 및 API

### 8.1 페이지
| URL | 역할 | 접근 권한 |
|-----|------|----------|
| `/admin/login/` | 로그인 페이지 | 공개 (비인증) |
| `/dashboard` | 대시보드 (로그인 후 이동) | 인증 필요 |

### 8.2 API 엔드포인트
| Method | Endpoint | 설명 | 인증 |
|--------|----------|------|------|
| GET | `/admin/login/` | 로그인 폼 렌더링 | 불필요 |
| POST | `/admin/login/` | 로그인 요청 처리 | 불필요 |

### 8.3 Django 모듈
| 모듈 | 역할 |
|------|------|
| `django.contrib.auth` | 인증 백엔드 |
| `django.contrib.sessions` | 세션 관리 |
| `django.middleware.csrf` | CSRF 보호 |

---

## 9. 보안 요구사항

### 9.1 인증
- **비밀번호 해싱**: Django 기본 PBKDF2 알고리즘 (SHA256, 600,000 iterations)
- **CSRF 보호**: 모든 POST 요청에 CSRF 토큰 필수
- **세션 보안**:
  - HttpOnly 플래그 (XSS 방지)
  - Secure 플래그 (HTTPS 전용)
  - SameSite=Lax (CSRF 추가 방어)

### 9.2 계정 보호
- **계정 잠금**: 5회 연속 실패 시 15분간 잠금
- **로그 기록**: 모든 로그인 시도 (성공/실패) 기록
- **타임아웃**: 세션 유지 시간 7일 (설정 가능)

### 9.3 정보 보호
- **에러 메시지**: Username 존재 여부 노출 금지 (보안상 동일 메시지)
- **비밀번호 규칙**: Django Admin에서 강력한 비밀번호 정책 적용
- **로그인 이력**: IP 주소, User-Agent 기록 (향후 확장)

---

## 10. 비기능 요구사항

### 10.1 성능
| 지표 | 목표 |
|------|------|
| 로그인 처리 시간 | 1초 이내 |
| 세션 쿠키 저장 | 즉시 (응답 헤더) |
| CSRF 토큰 검증 | 100ms 이내 |

### 10.2 가용성
- Django 인증 시스템은 Django 프레임워크 자체 가용성에 의존
- 데이터베이스 장애 시 인증 불가 (PostgreSQL 의존)

### 10.3 사용성
- 로그인 폼은 단순하고 직관적
- 에러 메시지는 명확하고 한글로 표시
- 모바일 반응형 지원 (Material UI)

---

## 11. 데이터 요구사항

### 11.1 사용 테이블
| 테이블 | 용도 | 관리 방법 |
|--------|------|----------|
| `auth_user` | Django 기본 사용자 모델 | Django Admin |
| `django_session` | 세션 데이터 저장 | 자동 관리 |

### 11.2 세션 데이터 구조
```json
{
  "_auth_user_id": "1",
  "_auth_user_backend": "django.contrib.auth.backends.ModelBackend",
  "_auth_user_hash": "abc123..."
}
```

---

## 12. 외부 연동 서비스

### 12.1 연동 없음
- 현재 버전에서는 외부 OAuth, SAML, LDAP 등 연동하지 않음
- Django Native Auth만 사용
- 향후 대학교 통합 인증 시스템 연동 가능성 열어둠

---

## 13. UI/UX 요구사항

### 13.1 로그인 페이지 구성
- **헤더**: "대학 데이터 시각화 대시보드" 제목
- **폼 영역**:
  - Username 입력 필드 (Label: "아이디")
  - Password 입력 필드 (Label: "비밀번호", type="password")
  - "로그인" 버튼 (Primary Color)
- **에러 메시지 영역**: 상단에 빨간색 경고 박스
- **푸터**: 저작권 정보 (선택)

### 13.2 인터랙션
- Enter 키 입력 시 로그인 버튼 클릭 동작
- 로딩 중 버튼 비활성화 + 스피너 표시
- 에러 발생 시 입력 필드에 빨간색 테두리

---

## 14. 테스트 시나리오

### 14.1 정상 케이스
| 테스트 ID | 시나리오 | 예상 결과 |
|-----------|----------|----------|
| TC-001-01 | 유효한 Username/Password 입력 | 로그인 성공, 대시보드 이동 |
| TC-001-02 | 세션 쿠키 확인 | 브라우저에 쿠키 저장됨 |
| TC-001-03 | 세션 유지 확인 | 페이지 새로고침 후에도 로그인 상태 유지 |

### 14.2 실패 케이스
| 테스트 ID | 시나리오 | 예상 결과 |
|-----------|----------|----------|
| TC-001-04 | 잘못된 Password 입력 | 에러 메시지 표시, 로그인 실패 |
| TC-001-05 | 존재하지 않는 Username 입력 | 에러 메시지 표시, 로그인 실패 |
| TC-001-06 | 5회 연속 실패 | 계정 잠금 메시지 표시 |
| TC-001-07 | CSRF 토큰 없이 요청 | 403 Forbidden 응답 |

### 14.3 보안 케이스
| 테스트 ID | 시나리오 | 예상 결과 |
|-----------|----------|----------|
| TC-001-08 | SQL Injection 시도 | ORM 자동 방어 |
| TC-001-09 | XSS 공격 시도 | 입력 이스케이핑 처리 |
| TC-001-10 | Brute Force 공격 | 5회 후 계정 잠금 |

---

## 15. 참고사항

### 15.1 Django Admin 활용
- 현재 버전에서는 Django Admin의 로그인 페이지를 그대로 활용
- 커스터마이징 최소화 (개발 속도 우선)
- 향후 React 커스텀 로그인 페이지 개발 가능

### 15.2 세션 vs JWT
- **선택**: Session 기반 인증
- **이유**:
  - Django 기본 제공 기능 활용 (개발 시간 단축)
  - 내부 직원 전용 (API 공개 불필요)
  - 세션 무효화 용이 (로그아웃 시 즉시 반영)

### 15.3 향후 개선 방향
- React 커스텀 로그인 페이지 개발
- 소셜 로그인 연동 (Google, Microsoft)
- 2단계 인증 (2FA) 추가
- 비밀번호 찾기 기능

---

## 16. 의존성

### 16.1 기술 스택
| 항목 | 기술 | 버전 |
|------|------|------|
| 백엔드 프레임워크 | Django | 5.x |
| 인증 모듈 | django.contrib.auth | 내장 |
| 데이터베이스 | PostgreSQL (Supabase) | 15+ |
| 프론트엔드 | React (Vite) | 18+ |

### 16.2 환경 변수
```bash
SECRET_KEY=<django-secret-key>
SESSION_COOKIE_SECURE=True
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax
SESSION_COOKIE_AGE=604800  # 7일
```

---

## 17. 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-12-18 | 초안 작성 | Usecase Writer Agent |

---

**End of Document**
