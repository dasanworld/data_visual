# UseCase: 로그아웃

**문서 버전:** 1.0
**작성일:** 2025-12-18
**기능 번호:** 005
**기능명:** 로그아웃

---

## 1. 개요

사용자가 시스템에서 안전하게 로그아웃하여 세션을 종료하고 인증 상태를 해제하는 기능입니다. 로그아웃 후에는 보호된 리소스에 접근할 수 없으며, 재인증이 필요합니다.

---

## 2. 액터 (Actors)

### 주요 액터
- **인증된 사용자**: 시스템에 로그인한 모든 사용자 (관리자/일반 사용자)

### 부 액터
- **Django Authentication System**: 세션 관리 및 인증 처리
- **React Frontend**: 로그아웃 버튼 제공 및 상태 관리

---

## 3. 사전 조건 (Preconditions)

- 사용자가 이미 로그인되어 있어야 함
- 유효한 세션 쿠키가 브라우저에 존재해야 함
- 사용자가 보호된 페이지 (대시보드, 업로드, 데이터 테이블 등)에 접근 가능한 상태

---

## 4. 사후 조건 (Postconditions)

### 성공 시
- 사용자의 세션이 서버에서 삭제됨
- 세션 쿠키가 무효화됨 (만료 시간 과거로 설정)
- React 전역 상태가 초기화됨
- 로컬 스토리지/세션 스토리지가 클리어됨
- 사용자가 로그인 페이지로 리다이렉트됨
- 로그아웃 후 뒤로가기를 해도 보호된 페이지에 접근 불가

### 실패 시
- 네트워크 오류 발생 시에도 클라이언트 측에서 강제로 로그인 페이지로 리다이렉트
- 세션이 이미 만료된 경우에도 정상적으로 로그인 페이지로 이동

---

## 5. 기본 플로우 (Main Flow)

### 5.1 사용자 동작
1. 사용자가 대시보드, 업로드, 데이터 테이블 등의 페이지에서 사이드바 또는 헤더의 **로그아웃 버튼**을 클릭

### 5.2 시스템 처리
2. React Frontend가 로그아웃 요청을 준비
   - CSRF 토큰을 요청 헤더에 포함
   - `/admin/logout/` 엔드포인트로 POST 요청 전송

3. Django Backend가 요청을 수신
   - CSRF 토큰 검증
   - 세션 유효성 확인

4. Django가 세션 종료 처리
   - `django.contrib.auth.logout()` 함수 호출
   - 세션 데이터 삭제 (서버 측 세션 스토어에서 제거)
   - 세션 쿠키 무효화 (Set-Cookie 헤더로 만료 시간 과거로 설정)

5. React Frontend가 응답을 수신
   - HTTP 302 리다이렉트 응답 또는 200 성공 응답 확인
   - React 전역 상태 초기화 (Context API 또는 State Management)
     - 사용자 정보 삭제
     - 인증 상태 false로 설정
   - 로컬 스토리지/세션 스토리지 클리어
     - `localStorage.clear()` 또는 특정 키 삭제
     - `sessionStorage.clear()`

6. 사용자 리다이렉트
   - 로그인 페이지(`/admin/login/`)로 자동 이동
   - (선택 사항) "로그아웃되었습니다" 확인 메시지 표시

---

## 6. 대안 플로우 (Alternative Flows)

### 6.1 네트워크 오류
**트리거:** 로그아웃 요청 중 네트워크 오류 발생
**처리:**
1. Frontend에서 타임아웃 감지 (예: 10초)
2. 에러 발생 시에도 **클라이언트 측에서 강제로 상태 초기화**
   - 세션 쿠키 삭제 불가능하더라도 로컬 상태는 클리어
3. 로그인 페이지로 강제 리다이렉트
4. (선택 사항) "로그아웃 처리 중 오류가 발생했습니다. 다시 로그인해주세요." 메시지 표시

### 6.2 세션 이미 만료
**트리거:** 로그아웃 요청 시 세션이 이미 만료됨
**처리:**
1. Backend가 401 Unauthorized 또는 403 Forbidden 응답
2. Frontend에서 정상적인 로그아웃으로 간주
3. 로그인 페이지로 리다이렉트
4. 에러 메시지 표시하지 않음

### 6.3 CSRF 토큰 만료
**트리거:** CSRF 토큰이 만료되어 요청 실패
**처리:**
1. Backend가 403 CSRF Verification Failed 응답
2. Frontend에서 강제로 상태 클리어
3. 로그인 페이지로 리다이렉트
4. (선택 사항) "세션이 만료되었습니다. 다시 로그인해주세요." 메시지

---

## 7. 예외 플로우 (Exception Flows)

### 7.1 서버 오류 (5xx)
**트리거:** Backend에서 500 Internal Server Error 발생
**처리:**
1. Frontend에서 에러 감지
2. 클라이언트 측 상태 강제 초기화
3. 로그인 페이지로 리다이렉트
4. "서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요." 메시지

### 7.2 동시 다중 로그아웃 요청
**트리거:** 사용자가 로그아웃 버튼을 여러 번 클릭
**처리:**
1. Frontend에서 첫 번째 요청 후 버튼 비활성화
2. 추가 클릭은 무시
3. 첫 번째 요청의 결과만 처리

---

## 8. 연관 API

### 8.1 로그아웃 API

**Endpoint:** `POST /admin/logout/`
**인증:** 세션 쿠키 필수
**CSRF:** 필수 (POST 요청이므로 CSRF 토큰 필요)

**Request:**
```http
POST /admin/logout/ HTTP/1.1
Host: example.railway.app
Cookie: sessionid=abc123...
X-CSRFToken: xyz789...
```

**Response (성공):**
```http
HTTP/1.1 302 Found
Location: /admin/login/
Set-Cookie: sessionid=; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/
```

**Response (이미 로그아웃 상태):**
```http
HTTP/1.1 302 Found
Location: /admin/login/
```

---

## 9. 연관 페이지

### 9.1 로그아웃 버튼이 있는 페이지
- **대시보드 페이지** (`/dashboard`)
  - 사이드바에 로그아웃 버튼
  - 헤더 우측 상단에 사용자 메뉴 (드롭다운) 내 로그아웃 옵션

- **데이터 업로드 페이지** (`/upload`)
  - 사이드바에 로그아웃 버튼

- **데이터 테이블 페이지** (`/data-table`)
  - 사이드바에 로그아웃 버튼

### 9.2 리다이렉트 대상 페이지
- **로그인 페이지** (`/admin/login/`)
  - 로그아웃 후 자동 이동
  - (선택 사항) "로그아웃되었습니다" 메시지 표시

---

## 10. 외부 연동 서비스

없음 (Django 내부 인증 시스템만 사용)

---

## 11. 보안 고려사항

### 11.1 세션 완전 종료
- 서버 측 세션 데이터 완전 삭제
- 쿠키 만료 시간을 과거로 설정하여 브라우저에서 제거
- 세션 ID 재사용 방지

### 11.2 클라이언트 측 정리
- React 전역 상태 초기화 (메모리 누수 방지)
- 로컬 스토리지/세션 스토리지 클리어 (민감 정보 제거)
- 인증 토큰 또는 사용자 정보가 남아있지 않도록 확인

### 11.3 뒤로가기 방지
- 로그아웃 후 브라우저 뒤로가기를 하더라도 보호된 페이지 접근 차단
- 모든 보호된 페이지에서 세션 확인 후 미인증 시 로그인 페이지로 리다이렉트

### 11.4 CSRF 보호
- POST 요청이므로 CSRF 토큰 필수
- Django 기본 CSRF 미들웨어 활용

---

## 12. 성능 요구사항

- 로그아웃 요청 응답 시간: **1초 이내**
- 로그인 페이지 리다이렉트 완료: **2초 이내**
- 세션 삭제 처리: **100ms 이내**

---

## 13. UI/UX 요구사항

### 13.1 로그아웃 버튼
- **위치**: 사이드바 하단 또는 헤더 우측 상단 사용자 메뉴
- **아이콘**: Material UI LogoutIcon
- **텍스트**: "로그아웃"
- **색상**: 중립적인 색상 (Primary 또는 Secondary)

### 13.2 확인 다이얼로그 (선택 사항)
- 사용자가 실수로 로그아웃하는 것을 방지하기 위해 확인 다이얼로그 표시 가능
- "로그아웃하시겠습니까?" 메시지
- "확인" / "취소" 버튼

### 13.3 로딩 상태
- 로그아웃 요청 중 버튼 비활성화
- 로딩 스피너 표시 (선택 사항)

### 13.4 성공 메시지 (선택 사항)
- 로그인 페이지로 리다이렉트 후 "로그아웃되었습니다" 메시지
- 3초 후 자동으로 사라짐

---

## 14. 테스트 시나리오

### 14.1 정상 케이스
1. 사용자가 대시보드에서 로그아웃 버튼 클릭
2. 로그인 페이지로 리다이렉트 확인
3. 브라우저 뒤로가기로 대시보드 접근 시도
4. 로그인 페이지로 자동 리다이렉트 확인

### 14.2 네트워크 오류
1. 네트워크 연결 차단 (개발자 도구 Network 탭)
2. 로그아웃 버튼 클릭
3. 타임아웃 후 클라이언트 측에서 강제 리다이렉트 확인

### 14.3 세션 만료 상태에서 로그아웃
1. 세션 수동으로 만료시키기 (서버에서 세션 삭제)
2. 로그아웃 버튼 클릭
3. 에러 없이 로그인 페이지로 이동 확인

### 14.4 동시 다중 요청
1. 로그아웃 버튼을 빠르게 여러 번 클릭
2. 첫 번째 요청만 처리되고 나머지는 무시되는지 확인
3. 정상적으로 로그인 페이지로 이동 확인

---

## 15. 엣지케이스

### 15.1 이미 로그아웃된 상태에서 보호된 페이지 접근
**상황:** 다른 탭에서 로그아웃 후 현재 탭에서 대시보드 사용 시도
**처리:** 모든 API 요청에서 401 Unauthorized 응답 시 자동으로 로그인 페이지로 리다이렉트

### 15.2 동일 계정 여러 브라우저에서 로그인
**상황:** Chrome과 Safari에서 동일 계정 로그인 후 한쪽에서 로그아웃
**처리:**
- Django는 세션별로 독립적으로 관리
- 한 브라우저에서 로그아웃해도 다른 브라우저의 세션은 유지
- (선택 사항) 모든 세션 종료 기능 추가 가능 (현재 요구사항에는 없음)

### 15.3 로그아웃 후 API 요청
**상황:** 로그아웃 직후 백그라운드에서 실행 중인 API 요청이 있을 경우
**처리:**
- API 요청이 401 Unauthorized 응답
- Frontend에서 에러 핸들링 (이미 로그인 페이지로 이동했으므로 무시)

---

## 16. 향후 확장 가능성

- **모든 디바이스에서 로그아웃**: 현재 세션뿐만 아니라 모든 활성 세션 종료
- **로그아웃 로그 기록**: 감사(Audit) 목적으로 로그아웃 시간 기록
- **자동 로그아웃**: 일정 시간 비활성 시 자동 로그아웃 (Session Timeout)

---

**문서 변경 이력**

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-12-18 | 초안 작성 | UseCase Writer Agent |
